{% extends "base.html" %}
{% block content %}

<div class="text-center">
    <h2 class="mb-3">ðŸ“· Scan Doorbell QR</h2>
    <p class="text-muted">Tap the button and allow camera access</p>

    <button id="startScan" class="btn btn-primary mb-3">
        â–¶ Start Camera
    </button>

    <div id="reader" style="width:300px; margin:auto;"></div>

    <p class="mt-3 text-muted">
        Point your camera at the QR code
    </p>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>

<script>
    const scanner = new Html5Qrcode("reader");

    document.getElementById("startScan").addEventListener("click", () => {
        scanner.start(
            { facingMode: "environment" },
            { fps: 10, qrbox: 250 },
            qrCodeMessage => {
                scanner.stop().then(() => {
                    window.location.href = qrCodeMessage;
                });
            },
            error => {}
        ).catch(err => {
            alert("Camera permission denied or not supported");
        });
    });
</script>

{% endblock %}
